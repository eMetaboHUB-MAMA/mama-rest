# Changelog

Technical change between REST API releases

<!--
## Template
- **@version**: `xxx`
- **@notes**:
  - describe this release's reasons
- **@new**:
  - mama#xx - short description - short_sha or merge_request
- **@bugs fixed**:
  - mama#xx - short description - short_sha or merge_request
- **@other**:
  - mama#xx - short description - short_sha or merge_request
- **@known bugs**:
  - mama#xx - short description
-->

## Latest

- **@version**: `1.3.1`
- **@notes**:
  - fix critical bug: daily/weekly email sender doesn't work any more
- **@bugs fixed**:
  - mama#95 - load variables used by jobby (cron task like daily / weekly emails)

## Previous releases

### 2023-06-12

- **@version**: `1.3.0`
- **@notes**:
  - feedbacks from MTH and MTH's SAB boards
- **@new**:
  - mama#60 - Support clients' laboratories RNSR identifier (for French public labs.)
  - mama#61 - new 'manager context' field in 'project extra data'
  - mama#61 - fields 'administrative/manager/geographical context' are now mandatory to switch a project to 'running' status
  - mama#62 - add 'metabohub platform' filter in statistics view
  - mama#64 - add 'formal user' value for "how did you known MTH" question (field in 'MTH stats' box)
  - mama#65 - add projects 'multi-sites management' (field in 'MTH stats' box)
  - mama#65 - support new 'multi-sites' entries (backoffice)
  - mama#66 - add thematic keywords in 'MTH stats' box (only for projects manager)
  - mama#67 - in projects view, if a user launch a search using a project ID as keyword, redirect to this project sheet
  - mama#68 - add "ID to follow project outside of MAMA" (field in 'MTH stats' box)
  - mama#77 - add 'how did you known MTH' in projects XLS export
- **@bugs fixed**:
  - mama#71 - fix footer display bug (by removing Matomo deprecated tracking code)
  - mama#74 - fix Memcached variables loading error
  - mama#78 - during project update, send an email to users only if an update really occurred on project 'core data'
- **@other**:
  - mama#70 - improve `Memcached` management: support different caches for each different host
  - mama#73 - improve tests databases generation (devops)
  - mama#75 - improve ORM cache management (support many MAMA instances on the same server)

Warnings:

- database schema has been updated
- a new json file is required; it is generated by a PHP script (see mama#60)

Please run these commands:

```bash
# go to mama-rest app folder
cd /var/www/html/mama-rest
# update entities cache
sudo -u www-data vendor/bin/doctrine orm:generate-proxies
# update database
sudo -u www-data vendor/bin/doctrine orm:schema-tool:update --force
# go to mama-webapp app folder
cd /var/www/html/mama-webapp/
# update labs RNSR list
sudo -u www-data php -f ./tools/update_rnsr_list.php
```

### 2023-03-15

- **@version**: `1.2.0`
- **@notes**:
  - update PHP version from 7.4 to 8.1; update composer dependencies
- **@bugs fixed**:
  - mama#54 - fix minor orthography errors in GUI
- **@other**:
  - mama#dev - update CI server (switch to sauron)
  - mama#dev - update DEV server (switch to unh-pfemlindev)
  - mama#dev - add new MIT license (WebApp and REST API)
  - mama#58 - set config. new PROD server
  - mama#59 - non-LDAP users password mgmt: remove in-house salt option (deprecated with PHP 8)
  - mama#59 - update for Ubuntu 22.04 / PHP 8.1 support

### 2021-11-24

- **@version**: `v1.1.0`
- **@notes**:
  - feedback from MTH2-WP6
- **@new**:
  - mama#39 - add contact form GUI and controller (only for registered users)
  - mama#41 - a user can set its favourite MTH platform in his profile (only PM/admin) - :warning: require a database update (cf SQL code below)
  - mama#41 - new indicator: count projects per user platform (only PM/admin)
  - mama#53 - new 'rejected reason' value: `canceled by client`
- **@other**:
  - mama#40 - update vocabulary on GUI for `add new project` form

```bash
# go to mama-rest app folder
cd /var/www/html/mama-rest
# update entities cache
sudo -u www-data vendor/bin/doctrine orm:generate-proxies
chown www-data:www-data /tmp/__*
# update database
sudo -u www-data vendor/bin/doctrine orm:schema-tool:update --force
```

```ini
; file config/mama-config.ini
[contact]
email = "contacts-mama-mth@inrae.fr"
name = "MAMA - Contact"
```

### 2021-10-29

- **@version**: `v1.0.5`
- **@new**:
  - mama#32 - add "confirmation box/message" when a request is rejected
  - mama#33 - get a list of "rejected" requests with associated "rejected reasons" in `statistics view` and `projects XLS file export`
  - mama#35 - get 'response delay' (in days) indicator in `projects XLS file export` and `GET projects web GUI` (only for PM)
  - mama#36 - update `search/list projects` view and service:
    - add "owner email pattern filter"
    - "in charge email pattern filter"
    - "involved email pattern filter"
  - mama#42 - update `search/list projects` view: improve "plateforms" filter (label + select multiple)
  - mama#43 - update `search/list projects` XLS export:
    - add `administratif context` column
    - add `geographical context` column
    - add `public/private context` column
  - mama#46 - statistics view: add new `funding source/types` graph.; also improve graph. listing
  - mama#47 - get project owner information contact (add `phone` and `address` in `project` view / preview)
  - mama#48 - update `search/list projects` service: improve "plateforms" filter (support select multiple from mama#42)
- **@bugs fixed**:
  - mama#34 - reject / paused "reason text" is now optional
  - mama#37 - increase 'messages' and 'appointments' modals sizes; increase 'MTH dialog box' size (projects' extra-data)
- **@other**:
  - mama#26 - update CI file to improve releases
  - mama#27 - update CI config. and Docker images for tests
  - mama#28 - add users' email addresses in XLS file export
  - mama#51 - update composer dependencies
  - mama#52 - update matomo analytics code

### 2020-10-14

- **@version**: `v1.0.4`
- **@bugs fixed**:
  - mama#22 - fix HTTP/HTML links in emails
  - mama#23 - fix "clean restricted informations on NULL object" error
- **@other**:
  - mama#20 - update CI to match prod. env. - mama@f7ce718d
  - mama#21 - display webapp and rest api versions in footer
  - mama#12 - switch an analysis request back to `waiting` status
  - mama#24 - manage reject a project because `saved twice` reason

### 2020-05-14

- **@version**: `v1.0.3`
- **@notes**:
  - bugfix
- **@new**:
  - mama-webapp#52 - add CI/CD pipeline - mama-rest@7f5d8cee
  - mama-webapp#55 - add confirmation dialog when a project manager is set
  - mama-webapp#56 - allow users and manager to remove uploaded file (scientific context)
  - mama#2 - add `dialog box` support (mama#8, mama#9)
- **@bugs fixed**:
  - mama-webapp#51 - update PHPExcel library - mama-rest@cd709e80
  - mama#18 - increase text size for scientific context and add GUI control
- **@other**:
  - mama-webapp#57 - update Matomo tracker code - mama-webapp@d02eab4e
  - mama#14 - set "inactive user" timeout from 6 months to 2 years
  - mama#15 - reject projects form field are now mandatory

Third part dependencies for MAMA-REST

```sh
# for PHP-Excel
sudo apt-get install -y php7.0-gd php7.0-mbstring php7.0-zip
```

Update SQL query:

```sql
mysql> UPDATE   users
    -> SET      email = CONCAT(LEFT(email, INSTR(email, '@')), 'inrae.fr')
    -> WHERE    email LIKE '%@inra.fr%' AND login NOT LIKE '%@%';
```

### 2017-12-15 (bis)

- **@version**: `v1.0.2`
- **@notes**:
  - minor release
  - fix orthography errors (webapp)

### 2017-12-15

- **@version**: `v1.0.1`
- **@notes**:
  - minor release
  - fix orthography errors (webapp)

### 2017-07-06

- **@version**: `v1.0.0`
- **@notes**:
  - first MAMA SI release
